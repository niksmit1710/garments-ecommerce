{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ product.name }}</title>

    <!-- Bootstrap -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>

<div class="container mt-5">
    <div class="row">

        <!-- ========== LEFT : IMAGE GALLERY ========== -->
        <div class="col-md-5">

            <!-- Main Image Wrapper -->
            <div class="image-wrapper mb-3">
                <button class="arrow-btn arrow-left" onclick="showPrev()">❮</button>

                <img id="mainImage"
                     src="{{ product.image.url }}"
                     alt="{{ product.name }}">

                <button class="arrow-btn arrow-right" onclick="showNext()">❯</button>
            </div>

            <!-- Thumbnails -->
            <div class="d-flex gap-2 flex-wrap">
                <img src="{{ product.image.url }}"
                     class="thumb-img active"
                     onclick="changeImage(this)">

                {% for img in product.images.all %}
                    <img src="{{ img.image.url }}"
                         class="thumb-img"
                         onclick="changeImage(this)">
                {% endfor %}
            </div>
        </div>

        <!-- ========== RIGHT : PRODUCT INFO ========== -->
        <div class="col-md-7">
            <h2>{{ product.name }}</h2>

            {% if product.brand %}
                <p class="text-muted">
                    Brand: <strong>{{ product.brand.name }}</strong>
                </p>
            {% endif %}

            <h4>₹ {{ product.price }}</h4>

            <p>{{ product.description }}</p>

            {% if product.sizes.all %}
                <label class="form-label"><strong>Select Size</strong></label>
                <select class="form-select mb-3">
                    {% for size in product.sizes.all %}
                        <option>{{ size }}</option>
                    {% endfor %}
                </select>
            {% endif %}

            {% if product.stock > 0 %}
                <p class="text-success">In Stock</p>
            {% else %}
                <p class="text-danger">Out of Stock</p>
            {% endif %}

            <button class="btn btn-dark btn-lg w-100">
                Add to Cart
            </button>
        </div>

    </div>
</div>

<!-- ========== JS FOR IMAGE CONTROL ========== -->
<script>
    const mainImage = document.getElementById("mainImage");
    const thumbs = document.querySelectorAll(".thumb-img");
    let currentIndex = 0;

    function changeImage(el) {
        mainImage.src = el.src;
        thumbs.forEach(t => t.classList.remove("active"));
        el.classList.add("active");
        currentIndex = [...thumbs].indexOf(el);
    }

    function showNext() {
        currentIndex = (currentIndex + 1) % thumbs.length;
        changeImage(thumbs[currentIndex]);
    }

    function showPrev() {
        currentIndex = (currentIndex - 1 + thumbs.length) % thumbs.length;
        changeImage(thumbs[currentIndex]);
    }

    /* Swipe support (mobile) */
    let startX = 0;

    mainImage.addEventListener("touchstart", e => {
        startX = e.touches[0].clientX;
    });

    mainImage.addEventListener("touchend", e => {
        let endX = e.changedTouches[0].clientX;
        if (startX - endX > 50) showNext();
        if (endX - startX > 50) showPrev();
    });
</script>

</body>
</html>
